# Using `spt cggnn`

The intended procedure for using `spt cggnn` is
1. Explore the data available for the study of your choice and train the model
   1. Evaluate the specimen cohorts at your disposal with `spt cggnn explore-classes`.
   2. Now that you know which specimen cohorts ("strata") you want to use, fetch the relevant data artifacts from SPT using `spt cggnn extract`.
   3. Artifacts in hand, use `spt cggnn run` or the `cg-gnn` pip package directly to train and fine-tune your CG-GNN model.
2. Given that you now know the parameters you used to arrive at your fine-tuned CG-GNN model, use `spt workflow configure` to create artifacts that will reproducibly run through the entire process of gathering the data for, training, and reporting with your trained model. Then, your workflow can be run in one line using Nextflow to approximately reproduce your model and results.

This document will go into more detail on the second step.

## Running `spt workflow configure` for `cggnn`

To configure the `cggnn` SPT workflow, you must provide the following parameters as follows:

```
spt workflow configure --local --workflow='cggnn' --study-name=... --database-config-file=... --workflow-config-file=...
nextflow run .
```

`study-name` is the name of your study as known by your SPT database instance, and `database-config-file` is the location of your database configuration file, in the format of `spatialprofilingtoolbox/workflow/assets/.workflow.config.template`.

`workflow-config-file` is more involved. Unused by other workflows (so far), it should be a YAML file following this template, as in `spatialprofilingtoolbox/workflow/assets/.workflow.config.template`:

```yaml
[settings]
strata = ...
validation_data_percent = ...
test_data_percent = ...
disable_channels = ...
disable_phenotypes = ...
cells_per_slide_target = ...
target_name = ...
in_ram = ...
batch_size = ...
epochs = ...
learning_rate = ...
k_folds = ...
explainer_model = ...
merge_rois = ...
prune_misclassified = ...
output_prefix = ...
upload_importances = ...
```

For detailed explanations of each parameter, please refer to the docstring for `spt cggnn run` or the `cg-gnn` pip package documentation. This article will only focus on the differences between the command line interface and the SPT workflow interface.

The main difference is that parameters can't be eliminated from the config file. Instead,
* if you want to use the default value for a parameter, you must explicitly set it to that value
* boolean values must explicitly be set to `true` or `false` instead of simply including or omitting the parameter
* `strata` can be set to `all` to use all strata (equivalent to not providing the parameter when using the CLI)
* `target_name` can be set to `none` to use all cells in the tissue sample (equivalent to not providing the parameter when using the CLI)
