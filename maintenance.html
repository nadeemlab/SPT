<?xml version="1.0" encoding="UTF-8" ?>
<html>
<head>
<style>
body {
    font-family: sans-serif;
    user-select: none;
}
div.textcontainer {
    width: 80%;
    margin: auto;
}
div.commandbox {
    background: #eff3f5;
    border: solid gray 1px;
    font-weight: bold;
    padding: 10px;
    margin: 0 0 10px 0;
    text-overflow: ellipsis;
    overflow: hidden;
}
div.codebox {
    background: #eef5f7;
    border: dotted gray 1px;
    padding: 10px;
    text-overflow: ellipsis;
    overflow: hidden;
}
</style>
</head>
<body>
<div class="textcontainer">
<h1>SPT documentation for maintenance and development</h1>
<p>SPT uses <a href="https://www.gnu.org/software/make/">Make</a> to coordinate <a href="https://github.com/nadeemlab/SPT">code</a>, <a href="https://pypi.org/project/spatialprofilingtoolbox/">package</a>, <a href="https://hub.docker.com/repository/docker/nadeemlab/spt">container</a>, and <a href="https://spatialprofilingtoolbox.readthedocs.io">documentation</a> releases (rather than a more sophisticated CICD system).</p>

<p>Some behaviors are documented as Makefile help:</p>

<div class="commandbox"><code>make help</code></div>

<div class="codebox">
<pre>
#
# This is mainly a lightweight release-management script for coordinated
# PyPI, DockerHub, and GitHub releases of SPT (spatialprofilingtoolbox).
#
# The primary target is:
#
#     make release
#
# The above includes code testing.
#
# You can also release just the Docker image, to a test DockerHub repository,
# with no code testing:
#
#     make test-release
#
# You can also do just code testing:
#
#     make test
#
# or
#
#     make .unit-tests
#     make .integration-tests
#
# The following conventions are used:
#
# - Targets starting with '.' like '.all-credentials-available' create empty
#   files that are placeholders indicating an environment or build state. They
#   are all deleted on `make clean`, which you generally do not need to run
#   manually. This usage is called "empty target files to record events" in
#   the GNU Make documentation.
# - Most other targets are "PHONY", meaning that their recipes are always run
#   again whenever these targets are checked for completion. This is because
#   this Makefile is used for coordinating release actions rather than builds
#   per se.
#
# To show this text:
#
#     make help
#
</pre>
</div>

<p>The primary function is:</p>

<div class="commandbox"><code>make release</code></div>

<div class="codebox">
<pre>
Building spatialprofilingtoolbox==0.9.75 <span style="color:olive;">.....................</span> <span style="font-weight:bold;color:green;">Built.</span> ........................ 11s
Searching ~/.pypirc for PyPI credentials <span style="color:olive;">.....................</span> <span style="font-weight:bold;color:green;">Found.</span> ........................ 0s
Searching ~/.docker/config.json for docker credentials <span style="color:olive;">.......</span> <span style="font-weight:bold;color:green;">Found.</span> ........................ 0s
Creating venv <span style="color:olive;">................................................</span> <span style="font-weight:bold;color:green;">Created.</span> ...................... 1s
Installing spatialprofilingtoolbox into venv <span style="color:olive;">.................</span> <span style="font-weight:bold;color:green;">Installed.</span> .................... 25s
Doing unit tests <span style="color:olive;">.............................................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 3s
Searching for Nextflow installation <span style="color:olive;">..........................</span> <span style="font-weight:bold;color:green;">/home/user/bin/nextflow</span> ....... 0s
Integration test .diffusion_pipeline.sh <span style="color:olive;">......................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 22s
Integration test .density_pipeline.sh <span style="color:olive;">........................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 7s
Integration test .proximity_pipeline_balanced.sh <span style="color:olive;">.............</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 23s
Integration test .proximity_pipeline_with_thresholding.sh <span style="color:olive;">....</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 67s
Integration test .density_pipeline_with_intensities.sh <span style="color:olive;">.......</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 8s
Integration test .front_proximity_pipeline.sh <span style="color:olive;">................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 7s
Integration test .test_sqlite_merger.sh <span style="color:olive;">......................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 1s
Integration test .density_pipeline_with_thresholding.sh <span style="color:olive;">......</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 7s
Integration test .configure_gui.sh <span style="color:olive;">...........................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 2s
Integration test .proximity_pipeline.sh <span style="color:olive;">......................</span> <span style="font-weight:bold;color:green;">Passed.</span> ....................... 47s
[main 2b2d898] Autoreleasing v0.9.75
 1 file changed, 1 insertion(+), 1 deletion(-)
Uploading distributions to https://upload.pypi.org/legacy/
Uploading spatialprofilingtoolbox-0.9.75-py3-none-any.whl
  0%|          | 0.00/118k [00:00&lt;?, ?B/s]
  7%|▋         | 8.00k/118k [00:00&lt;00:05, 19.9kB/s]
100%|██████████| 118k/118k [00:01&lt;00:00, 73.8kB/s] 
Uploading spatialprofilingtoolbox-0.9.75.tar.gz
  0%|          | 0.00/86.9k [00:00&lt;?, ?B/s]
100%|██████████| 86.9k/86.9k [00:01&lt;00:00, 72.9kB/s]

View at:
https://pypi.org/project/spatialprofilingtoolbox/0.9.75/
Generating Dockerfile <span style="color:olive;">........................................</span> <span style="font-weight:bold;color:green;">Generated.</span> .................... 0s
Building Docker container <span style="color:olive;">....................................</span> <span style="font-weight:bold;color:green;">Built.</span> ........................ 146s
The push refers to repository [docker.io/nadeemlab/spt]
c6802fcaaa5f: Preparing
415bcf9592c6: Preparing
...
da55b45d310b: Layer already exists
33567021a86e: Pushed
0.9.75: digest: sha256:049878700552386812b95c32c811e5b4ab5eef2b03eaa2039d07e7d5be58b582 size: 6199
The push refers to repository [docker.io/nadeemlab/spt]
c6802fcaaa5f: Preparing
415bcf9592c6: Preparing
...
c9671a069ae4: Layer already exists
33567021a86e: Layer already exists
latest: digest: sha256:049878700552386812b95c32c811e5b4ab5eef2b03eaa2039d07e7d5be58b582 size: 6199
</pre>
</div>

<p>For this to work, you'll need to have write access to the GitHub repository, PyPI credentials or token authorizing push access to the package index, and DockerHub credentials authorizing container push access.</p>

<p>To capture the make output as colorized HTML, as shown above, install <a href="https://github.com/theZiz/aha">aha</a> and then use:</p>

<p>
<code>make release | tee >(aha > log_release.html)</code>
</p>

<p>For more information, see the <a href="https://github.com/nadeemlab/SPT/blob/main/Makefile">Makefile itself</a>.</p>

<!-- 
<h3>Version number tracking</h3>
<p>
The "master" copy of the current version number is located at <a href="https://github.com/nadeemlab/SPT/blob/main/SPT/spatialprofilingtoolbox/version.txt"><code>spatialprofilingtoolbox/version.txt</code></a> and is part of the package distribution.
</p>
<p>
A git hook, <a href="https://github.com/nadeemlab/SPT/blob/main/hooks/post-commit"><code>hooks/post-commit</code></a>, is provided to assist with version number tracking. If you install it to `.git/hooks/`, it will automatically increment the 3rd (most minor) version number on every commit. Otherwise you should <i>manually increment</i> the value in <code>version.txt</code> before <code>make release</code>.
</p>

<p>
Note that integrating this hook into your workflow requires a little care when merging branches. Typically one would want to delete `spatialprofilingtoolbox/version.txt` before checking out a different branch, since this text file will always be in the "modified" state right after a commit. This is essentially because there is no possibility of a "pre-commit hook".
</p>
-->

<p><i>Note</i>: The documentation is built with <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> on <a href="https://spatialprofilingtoolbox.readthedocs.io">Read the Docs</a>, triggered by code releases on a prescribed branch.</p>
</div>
</body>
</html>
